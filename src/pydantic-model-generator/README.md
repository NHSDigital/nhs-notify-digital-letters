<!-- vale Vale.Terms = NO -->
# pydantic-model-generator
<!-- vale Vale.Terms = YES -->

This package provides a tool that generates Pydantic v2 models for the events
that are defined in the JSON schemas that are built as part of this repository.
The generated Pydantic models can be used to validate and parse NHS Notify
Digital Letters events.

## Setup

Use `make install-dev` to install the necessary dependencies for this application.

## Generating Models

In order for this tool to function, you must first build the JSON schemas for
the Digital Letters events. The simplest way to build these schemas is to run
the `npm run generate-dependencies` command from the root of this repository.

### Using the Generator

Once the JSON schemas have been built, Pydantic models can be generated by running:

```bash
make generate
```

This will:

- Read all JSON event schemas from `schemas/digital-letters/2025-10-draft/events/`
- Generate Pydantic v2 models using `datamodel-code-generator`
- Output the models to `../digital-letters-events-python/models/`

### Configuration

The generator can be configured through:

- Command-line arguments
- Environment variables
- Configuration file (if needed)

### Output Structure

<!-- vale Vale.Terms = NO -->
<!-- vale Vale.Avoid = NO -->
Generated models are placed in the
[digital-letters-events-python](../digital-letters-events-python/) package:
<!-- vale Vale.Terms = YES -->
<!-- vale Vale.Avoid = YES -->

- `../digital-letters-events-python/models/` - Individual Pydantic model files
- `../digital-letters-events-python/models/__init__.py` - Combined index for easy imports

## Testing

Run tests using:

```bash
make test
```

For coverage reporting:

```bash
make coverage
```

## Development

### Prerequisites

- Python 3.11+
- pip or poetry for dependency management

### Installing Development Dependencies

```bash
make install-dev
```

### Running Tests

```bash
make test
```

## Usage

Once generated, the models can be used in your code as follows:

```python
from digital_letters_event_python import PrintLetterAvailable, CloudEventEnvelope

# Validate incoming event
event_data = CloudEventEnvelope(**raw_event)
if event_data.type == "uk.nhs.notify.digital.letters.letter.available.v1":
    letter_available = PrintLetterAvailable(**raw_event)
    # Process the validated event
```

## Architecture

The generator consists of:

- `scripts/generate_models.py` - Main CLI script
- `scripts/schema_processor.py` - Schema loading and processing
- `scripts/model_generator.py` - Pydantic model generation logic
- `scripts/file_utils.py` - File system utilities
